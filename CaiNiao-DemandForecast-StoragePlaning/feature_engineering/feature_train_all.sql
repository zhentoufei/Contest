/*全国训练数据，滑动窗口时按如下方式替换3段代码
窗口1：标签代码片段watch=0,其余片段watch=1    DATEDIFF('2015/12/14',DATE)AS days     1 AS watch
窗口2：标签代码片段watch=1,其余片段watch=2    DATEDIFF('2015/11/30',DATE)AS days     2 AS watch
窗口3：标签代码片段watch=2,其余片段watch=3    DATEDIFF('2015/11/16',DATE)AS days     3 AS watch
窗口4：标签代码片段watch=3,其余片段watch=4    DATEDIFF('2015/11/02',DATE)AS days     4 AS watch
窗口5：标签代码片段watch=4,其余片段watch=5    DATEDIFF('2015/10/19',DATE)AS days     5 AS watch
窗口6：标签代码片段watch=5,其余片段watch=6    DATEDIFF('2015/10/05',DATE)AS days     6 AS watch
窗口7：标签代码片段watch=6,其余片段watch=7    DATEDIFF('2015/09/21',DATE)AS days     7 AS watch
窗口8：标签代码片段watch=7,其余片段watch=8    DATEDIFF('2015/09/07',DATE)AS days     8 AS watch
窗口9：标签代码片段watch=8,其余片段watch=9    DATEDIFF('2015/08/24',DATE)AS days     9 AS watch
窗口10：标签代码片段watch=9,其余片段watch=10    DATEDIFF('2015/08/10',DATE)AS days     10 AS watch
*/
/*全国窗口1训练集*/
CREATE TABLE train_all_window1 AS
SELECT 1 AS watch,a.item_id,label,
 pv_ipv_1,pv_uv_1,cart_ipv_1,cart_uv_1,
 collect_uv_1, num_gmv_1, amt_gmv_1,qty_gmv_1,
 unum_gmv_1, amt_alipay_1, num_alipay_1, qty_alipay_1,
 unum_alipay_1, ztc_pv_ipv_1,tbk_pv_ipv_1, ss_pv_ipv_1,
 jhs_pv_ipv_1, ztc_pv_uv_1, tbk_pv_uv_1, ss_pv_uv_1,
 jhs_pv_uv_1, num_alipay_njhs_1, amt_alipay_njhs_1,
 qty_alipay_njhs_1, unum_alipay_njhs_1,
 pv_ipv_sum_1, pv_uv_sum_1, cart_ipv_sum_1, cart_uv_sum_1,
 collect_uv_sum_1, num_gmv_sum_1, amt_gmv_sum_1, qty_gmv_sum_1,
 unum_gmv_sum_1, amt_alipay_sum_1, num_alipay_sum_1,qty_alipay_sum_1,
unum_alipay_sum_1, ztc_pv_ipv_sum_1, tbk_pv_ipv_sum_1,ss_pv_ipv_sum_1,
 jhs_pv_ipv_sum_1,ztc_pv_uv_sum_1,tbk_pv_uv_sum_1, ss_pv_uv_sum_1,
 jhs_pv_uv_sum_1, num_alipay_njhs_sum_1, amt_alipay_njhs_sum_1,
 qty_alipay_njhs_sum_1, unum_alipay_njhs_sum_1,
  pv_ipv_2,pv_uv_2,cart_ipv_2,cart_uv_2,
 collect_uv_2, num_gmv_2, amt_gmv_2,qty_gmv_2,
 unum_gmv_2, amt_alipay_2, num_alipay_2, qty_alipay_2,
 unum_alipay_2, ztc_pv_ipv_2,tbk_pv_ipv_2, ss_pv_ipv_2,
 jhs_pv_ipv_2, ztc_pv_uv_2, tbk_pv_uv_2, ss_pv_uv_2,
 jhs_pv_uv_2, num_alipay_njhs_2, amt_alipay_njhs_2,
 qty_alipay_njhs_2, unum_alipay_njhs_2,
 pv_ipv_sum_2, pv_uv_sum_2, cart_ipv_sum_2, cart_uv_sum_2,
 collect_uv_sum_2, num_gmv_sum_2, amt_gmv_sum_2, qty_gmv_sum_2,
 unum_gmv_sum_2, amt_alipay_sum_2, num_alipay_sum_2,qty_alipay_sum_2,
unum_alipay_sum_2, ztc_pv_ipv_sum_2, tbk_pv_ipv_sum_2,ss_pv_ipv_sum_2,
 jhs_pv_ipv_sum_2,ztc_pv_uv_sum_2,tbk_pv_uv_sum_2, ss_pv_uv_sum_2,
 jhs_pv_uv_sum_2, num_alipay_njhs_sum_2, amt_alipay_njhs_sum_2,
 qty_alipay_njhs_sum_2, unum_alipay_njhs_sum_2,
  pv_ipv_3,pv_uv_3,cart_ipv_3,cart_uv_3,
 collect_uv_3, num_gmv_3, amt_gmv_3,qty_gmv_3,
 unum_gmv_3, amt_alipay_3, num_alipay_3, qty_alipay_3,
 unum_alipay_3, ztc_pv_ipv_3,tbk_pv_ipv_3, ss_pv_ipv_3,
 jhs_pv_ipv_3, ztc_pv_uv_3, tbk_pv_uv_3, ss_pv_uv_3,
 jhs_pv_uv_3, num_alipay_njhs_3, amt_alipay_njhs_3,
 qty_alipay_njhs_3, unum_alipay_njhs_3,
 pv_ipv_sum_3, pv_uv_sum_3, cart_ipv_sum_3, cart_uv_sum_3,
 collect_uv_sum_3, num_gmv_sum_3, amt_gmv_sum_3, qty_gmv_sum_3,
 unum_gmv_sum_3, amt_alipay_sum_3, num_alipay_sum_3,qty_alipay_sum_3,
unum_alipay_sum_3, ztc_pv_ipv_sum_3, tbk_pv_ipv_sum_3,ss_pv_ipv_sum_3,
 jhs_pv_ipv_sum_3,ztc_pv_uv_sum_3,tbk_pv_uv_sum_3, ss_pv_uv_sum_3,
 jhs_pv_uv_sum_3, num_alipay_njhs_sum_3, amt_alipay_njhs_sum_3,
 qty_alipay_njhs_sum_3, unum_alipay_njhs_sum_3,
 pv_ipv_5,pv_uv_5,cart_ipv_5,cart_uv_5,
 collect_uv_5, num_gmv_5, amt_gmv_5,qty_gmv_5,
 unum_gmv_5, amt_alipay_5, num_alipay_5, qty_alipay_5,
 unum_alipay_5, ztc_pv_ipv_5,tbk_pv_ipv_5, ss_pv_ipv_5,
 jhs_pv_ipv_5, ztc_pv_uv_5, tbk_pv_uv_5, ss_pv_uv_5,
 jhs_pv_uv_5, num_alipay_njhs_5, amt_alipay_njhs_5,
 qty_alipay_njhs_5, unum_alipay_njhs_5,
 pv_ipv_sum_5, pv_uv_sum_5, cart_ipv_sum_5, cart_uv_sum_5,
 collect_uv_sum_5, num_gmv_sum_5, amt_gmv_sum_5, qty_gmv_sum_5,
 unum_gmv_sum_5, amt_alipay_sum_5, num_alipay_sum_5,qty_alipay_sum_5,
unum_alipay_sum_5, ztc_pv_ipv_sum_5, tbk_pv_ipv_sum_5,ss_pv_ipv_sum_5,
 jhs_pv_ipv_sum_5,ztc_pv_uv_sum_5,tbk_pv_uv_sum_5, ss_pv_uv_sum_5,
 jhs_pv_uv_sum_5, num_alipay_njhs_sum_5, amt_alipay_njhs_sum_5,
 qty_alipay_njhs_sum_5, unum_alipay_njhs_sum_5,
  pv_ipv_7,pv_uv_7,cart_ipv_7,cart_uv_7,
 collect_uv_7, num_gmv_7, amt_gmv_7,qty_gmv_7,
 unum_gmv_7, amt_alipay_7, num_alipay_7, qty_alipay_7,
 unum_alipay_7, ztc_pv_ipv_7,tbk_pv_ipv_7, ss_pv_ipv_7,
 jhs_pv_ipv_7, ztc_pv_uv_7, tbk_pv_uv_7, ss_pv_uv_7,
 jhs_pv_uv_7, num_alipay_njhs_7, amt_alipay_njhs_7,
 qty_alipay_njhs_7, unum_alipay_njhs_7,
 pv_ipv_sum_7, pv_uv_sum_7, cart_ipv_sum_7, cart_uv_sum_7,
 collect_uv_sum_7, num_gmv_sum_7, amt_gmv_sum_7, qty_gmv_sum_7,
 unum_gmv_sum_7, amt_alipay_sum_7, num_alipay_sum_7,qty_alipay_sum_7,
unum_alipay_sum_7, ztc_pv_ipv_sum_7, tbk_pv_ipv_sum_7,ss_pv_ipv_sum_7,
 jhs_pv_ipv_sum_7,ztc_pv_uv_sum_7,tbk_pv_uv_sum_7, ss_pv_uv_sum_7,
 jhs_pv_uv_sum_7, num_alipay_njhs_sum_7, amt_alipay_njhs_sum_7,
 qty_alipay_njhs_sum_7, unum_alipay_njhs_sum_7,
  pv_ipv_9,pv_uv_9,cart_ipv_9,cart_uv_9,
 collect_uv_9, num_gmv_9, amt_gmv_9,qty_gmv_9,
 unum_gmv_9, amt_alipay_9, num_alipay_9, qty_alipay_9,
 unum_alipay_9, ztc_pv_ipv_9,tbk_pv_ipv_9, ss_pv_ipv_9,
 jhs_pv_ipv_9, ztc_pv_uv_9, tbk_pv_uv_9, ss_pv_uv_9,
 jhs_pv_uv_9, num_alipay_njhs_9, amt_alipay_njhs_9,
 qty_alipay_njhs_9, unum_alipay_njhs_9,
 pv_ipv_sum_9, pv_uv_sum_9, cart_ipv_sum_9, cart_uv_sum_9,
 collect_uv_sum_9, num_gmv_sum_9, amt_gmv_sum_9, qty_gmv_sum_9,
 unum_gmv_sum_9, amt_alipay_sum_9, num_alipay_sum_9,qty_alipay_sum_9,
unum_alipay_sum_9, ztc_pv_ipv_sum_9, tbk_pv_ipv_sum_9,ss_pv_ipv_sum_9,
 jhs_pv_ipv_sum_9,ztc_pv_uv_sum_9,tbk_pv_uv_sum_9, ss_pv_uv_sum_9,
 jhs_pv_uv_sum_9, num_alipay_njhs_sum_9, amt_alipay_njhs_sum_9,
 qty_alipay_njhs_sum_9, unum_alipay_njhs_sum_9,
  pv_ipv_11,pv_uv_11,cart_ipv_11,cart_uv_11,
 collect_uv_11, num_gmv_11, amt_gmv_11,qty_gmv_11,
 unum_gmv_11, amt_alipay_11, num_alipay_11, qty_alipay_11,
 unum_alipay_11, ztc_pv_ipv_11,tbk_pv_ipv_11, ss_pv_ipv_11,
 jhs_pv_ipv_11, ztc_pv_uv_11, tbk_pv_uv_11, ss_pv_uv_11,
 jhs_pv_uv_11, num_alipay_njhs_11, amt_alipay_njhs_11,
 qty_alipay_njhs_11, unum_alipay_njhs_11,
 pv_ipv_sum_11, pv_uv_sum_11, cart_ipv_sum_11, cart_uv_sum_11,
 collect_uv_sum_11, num_gmv_sum_11, amt_gmv_sum_11, qty_gmv_sum_11,
 unum_gmv_sum_11, amt_alipay_sum_11, num_alipay_sum_11,qty_alipay_sum_11,
unum_alipay_sum_11, ztc_pv_ipv_sum_11, tbk_pv_ipv_sum_11,ss_pv_ipv_sum_11,
 jhs_pv_ipv_sum_11,ztc_pv_uv_sum_11,tbk_pv_uv_sum_11, ss_pv_uv_sum_11,
 jhs_pv_uv_sum_11, num_alipay_njhs_sum_11, amt_alipay_njhs_sum_11,
 qty_alipay_njhs_sum_11, unum_alipay_njhs_sum_11,
  pv_ipv_14,pv_uv_14,cart_ipv_14,cart_uv_14,
 collect_uv_14, num_gmv_14, amt_gmv_14,qty_gmv_14,
 unum_gmv_14, amt_alipay_14, num_alipay_14, qty_alipay_14,
 unum_alipay_14, ztc_pv_ipv_14,tbk_pv_ipv_14, ss_pv_ipv_14,
 jhs_pv_ipv_14, ztc_pv_uv_14, tbk_pv_uv_14, ss_pv_uv_14,
 jhs_pv_uv_14, num_alipay_njhs_14, amt_alipay_njhs_14,
 qty_alipay_njhs_14, unum_alipay_njhs_14,
 pv_ipv_sum_14, pv_uv_sum_14, cart_ipv_sum_14, cart_uv_sum_14,
 collect_uv_sum_14, num_gmv_sum_14, amt_gmv_sum_14, qty_gmv_sum_14,
 unum_gmv_sum_14, amt_alipay_sum_14, num_alipay_sum_14,qty_alipay_sum_14,
unum_alipay_sum_14, ztc_pv_ipv_sum_14, tbk_pv_ipv_sum_14,ss_pv_ipv_sum_14,
 jhs_pv_ipv_sum_14,ztc_pv_uv_sum_14,tbk_pv_uv_sum_14, ss_pv_uv_sum_14,
 jhs_pv_uv_sum_14, num_alipay_njhs_sum_14, amt_alipay_njhs_sum_14,
 qty_alipay_njhs_sum_14, unum_alipay_njhs_sum_14,
 max_qty_alipay_njhs, min_qty_alipay_njhs, std_qty_alipay_njhs,
  cate_id_qty_alipay_njhs_sum, cate_id_qty_alipay_njhs_avg, cate_id_qty_alipay_njhs_std,
 cate_level_id_qty_alipay_njhs_sum, cate_level_id_qty_alipay_njhs_avg, cate_level_id_qty_alipay_njhs_std,
 brand_id_qty_alipay_njhs_sum, brand_id_qty_alipay_njhs_avg,brand_id_qty_alipay_njhs_std,
 supplier_id_qty_alipay_njhs_sum, supplier_id_qty_alipay_njhs_avg, supplier_id_qty_alipay_njhs_std
 FROM
 (
/*标签*/
SELECT item_id,SUM(qty_alipay_njhs)AS label
FROM (
SELECT a.* FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=0)a GROUP BY item_id
)a LEFT OUTER JOIN(
/*最近1天*/
SELECT item_id,AVG(pv_ipv)AS pv_ipv_1,AVG(pv_uv) AS pv_uv_1,AVG(cart_ipv)AS cart_ipv_1,AVG(cart_uv)AS cart_uv_1,
AVG(collect_uv)AS collect_uv_1,AVG(num_gmv)AS num_gmv_1,AVG(amt_gmv)AS amt_gmv_1,AVG(qty_gmv)AS qty_gmv_1,
AVG(unum_gmv)AS unum_gmv_1,AVG(amt_alipay)AS amt_alipay_1,AVG(num_alipay)AS num_alipay_1,AVG(qty_alipay)AS qty_alipay_1,
AVG(unum_alipay)AS unum_alipay_1,AVG(ztc_pv_ipv)AS ztc_pv_ipv_1,AVG(tbk_pv_ipv)AS tbk_pv_ipv_1,AVG(ss_pv_ipv)AS ss_pv_ipv_1,
AVG(jhs_pv_ipv)AS jhs_pv_ipv_1,AVG(ztc_pv_uv)AS ztc_pv_uv_1,AVG(tbk_pv_uv)AS tbk_pv_uv_1,AVG(ss_pv_uv)AS ss_pv_uv_1,
AVG(jhs_pv_uv)AS jhs_pv_uv_1,AVG(num_alipay_njhs)AS num_alipay_njhs_1,AVG(amt_alipay_njhs)AS amt_alipay_njhs_1,
AVG(qty_alipay_njhs)AS qty_alipay_njhs_1,AVG(unum_alipay_njhs)AS unum_alipay_njhs_1,
SUM(pv_ipv)AS pv_ipv_sum_1,SUM(pv_uv) AS pv_uv_sum_1,SUM(cart_ipv)AS cart_ipv_sum_1,SUM(cart_uv)AS cart_uv_sum_1,
SUM(collect_uv)AS collect_uv_sum_1,SUM(num_gmv)AS num_gmv_sum_1,SUM(amt_gmv)AS amt_gmv_sum_1,SUM(qty_gmv)AS qty_gmv_sum_1,
SUM(unum_gmv)AS unum_gmv_sum_1,SUM(amt_alipay)AS amt_alipay_sum_1,SUM(num_alipay)AS num_alipay_sum_1,SUM(qty_alipay)AS qty_alipay_sum_1,
SUM(unum_alipay)AS unum_alipay_sum_1,SUM(ztc_pv_ipv)AS ztc_pv_ipv_sum_1,SUM(tbk_pv_ipv)AS tbk_pv_ipv_sum_1,SUM(ss_pv_ipv)AS ss_pv_ipv_sum_1,
SUM(jhs_pv_ipv)AS jhs_pv_ipv_sum_1,SUM(ztc_pv_uv)AS ztc_pv_uv_sum_1,SUM(tbk_pv_uv)AS tbk_pv_uv_sum_1,SUM(ss_pv_uv)AS ss_pv_uv_sum_1,
SUM(jhs_pv_uv)AS jhs_pv_uv_sum_1,SUM(num_alipay_njhs)AS num_alipay_njhs_sum_1,SUM(amt_alipay_njhs)AS amt_alipay_njhs_sum_1,
SUM(qty_alipay_njhs)AS qty_alipay_njhs_sum_1,SUM(unum_alipay_njhs)AS unum_alipay_njhs_sum_1
FROM(
SELECT a.* FROM(
SELECT a.*,DATEDIFF('2015/12/14',DATE)AS days FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1)a WHERE days=1)a GROUP BY item_id
)b ON(a.item_id=b.item_id) LEFT OUTER JOIN(
/*最近2天*/
SELECT item_id,AVG(pv_ipv)AS pv_ipv_2,AVG(pv_uv) AS pv_uv_2,AVG(cart_ipv)AS cart_ipv_2,AVG(cart_uv)AS cart_uv_2,
AVG(collect_uv)AS collect_uv_2,AVG(num_gmv)AS num_gmv_2,AVG(amt_gmv)AS amt_gmv_2,AVG(qty_gmv)AS qty_gmv_2,
AVG(unum_gmv)AS unum_gmv_2,AVG(amt_alipay)AS amt_alipay_2,AVG(num_alipay)AS num_alipay_2,AVG(qty_alipay)AS qty_alipay_2,
AVG(unum_alipay)AS unum_alipay_2,AVG(ztc_pv_ipv)AS ztc_pv_ipv_2,AVG(tbk_pv_ipv)AS tbk_pv_ipv_2,AVG(ss_pv_ipv)AS ss_pv_ipv_2,
AVG(jhs_pv_ipv)AS jhs_pv_ipv_2,AVG(ztc_pv_uv)AS ztc_pv_uv_2,AVG(tbk_pv_uv)AS tbk_pv_uv_2,AVG(ss_pv_uv)AS ss_pv_uv_2,
AVG(jhs_pv_uv)AS jhs_pv_uv_2,AVG(num_alipay_njhs)AS num_alipay_njhs_2,AVG(amt_alipay_njhs)AS amt_alipay_njhs_2,
AVG(qty_alipay_njhs)AS qty_alipay_njhs_2,AVG(unum_alipay_njhs)AS unum_alipay_njhs_2,
SUM(pv_ipv)AS pv_ipv_sum_2,SUM(pv_uv) AS pv_uv_sum_2,SUM(cart_ipv)AS cart_ipv_sum_2,SUM(cart_uv)AS cart_uv_sum_2,
SUM(collect_uv)AS collect_uv_sum_2,SUM(num_gmv)AS num_gmv_sum_2,SUM(amt_gmv)AS amt_gmv_sum_2,SUM(qty_gmv)AS qty_gmv_sum_2,
SUM(unum_gmv)AS unum_gmv_sum_2,SUM(amt_alipay)AS amt_alipay_sum_2,SUM(num_alipay)AS num_alipay_sum_2,SUM(qty_alipay)AS qty_alipay_sum_2,
SUM(unum_alipay)AS unum_alipay_sum_2,SUM(ztc_pv_ipv)AS ztc_pv_ipv_sum_2,SUM(tbk_pv_ipv)AS tbk_pv_ipv_sum_2,SUM(ss_pv_ipv)AS ss_pv_ipv_sum_2,
SUM(jhs_pv_ipv)AS jhs_pv_ipv_sum_2,SUM(ztc_pv_uv)AS ztc_pv_uv_sum_2,SUM(tbk_pv_uv)AS tbk_pv_uv_sum_2,SUM(ss_pv_uv)AS ss_pv_uv_sum_2,
SUM(jhs_pv_uv)AS jhs_pv_uv_sum_2,SUM(num_alipay_njhs)AS num_alipay_njhs_sum_2,SUM(amt_alipay_njhs)AS amt_alipay_njhs_sum_2,
SUM(qty_alipay_njhs)AS qty_alipay_njhs_sum_2,SUM(unum_alipay_njhs)AS unum_alipay_njhs_sum_2
FROM(
SELECT a.* FROM(
SELECT a.*,DATEDIFF('2015/12/14',DATE)AS days FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1)a WHERE days<=2)a GROUP BY item_id
)c ON(a.item_id=c.item_id) LEFT OUTER JOIN(
/*最近3天*/
SELECT item_id,AVG(pv_ipv)AS pv_ipv_3,AVG(pv_uv) AS pv_uv_3,AVG(cart_ipv)AS cart_ipv_3,AVG(cart_uv)AS cart_uv_3,
AVG(collect_uv)AS collect_uv_3,AVG(num_gmv)AS num_gmv_3,AVG(amt_gmv)AS amt_gmv_3,AVG(qty_gmv)AS qty_gmv_3,
AVG(unum_gmv)AS unum_gmv_3,AVG(amt_alipay)AS amt_alipay_3,AVG(num_alipay)AS num_alipay_3,AVG(qty_alipay)AS qty_alipay_3,
AVG(unum_alipay)AS unum_alipay_3,AVG(ztc_pv_ipv)AS ztc_pv_ipv_3,AVG(tbk_pv_ipv)AS tbk_pv_ipv_3,AVG(ss_pv_ipv)AS ss_pv_ipv_3,
AVG(jhs_pv_ipv)AS jhs_pv_ipv_3,AVG(ztc_pv_uv)AS ztc_pv_uv_3,AVG(tbk_pv_uv)AS tbk_pv_uv_3,AVG(ss_pv_uv)AS ss_pv_uv_3,
AVG(jhs_pv_uv)AS jhs_pv_uv_3,AVG(num_alipay_njhs)AS num_alipay_njhs_3,AVG(amt_alipay_njhs)AS amt_alipay_njhs_3,
AVG(qty_alipay_njhs)AS qty_alipay_njhs_3,AVG(unum_alipay_njhs)AS unum_alipay_njhs_3,
SUM(pv_ipv)AS pv_ipv_sum_3,SUM(pv_uv) AS pv_uv_sum_3,SUM(cart_ipv)AS cart_ipv_sum_3,SUM(cart_uv)AS cart_uv_sum_3,
SUM(collect_uv)AS collect_uv_sum_3,SUM(num_gmv)AS num_gmv_sum_3,SUM(amt_gmv)AS amt_gmv_sum_3,SUM(qty_gmv)AS qty_gmv_sum_3,
SUM(unum_gmv)AS unum_gmv_sum_3,SUM(amt_alipay)AS amt_alipay_sum_3,SUM(num_alipay)AS num_alipay_sum_3,SUM(qty_alipay)AS qty_alipay_sum_3,
SUM(unum_alipay)AS unum_alipay_sum_3,SUM(ztc_pv_ipv)AS ztc_pv_ipv_sum_3,SUM(tbk_pv_ipv)AS tbk_pv_ipv_sum_3,SUM(ss_pv_ipv)AS ss_pv_ipv_sum_3,
SUM(jhs_pv_ipv)AS jhs_pv_ipv_sum_3,SUM(ztc_pv_uv)AS ztc_pv_uv_sum_3,SUM(tbk_pv_uv)AS tbk_pv_uv_sum_3,SUM(ss_pv_uv)AS ss_pv_uv_sum_3,
SUM(jhs_pv_uv)AS jhs_pv_uv_sum_3,SUM(num_alipay_njhs)AS num_alipay_njhs_sum_3,SUM(amt_alipay_njhs)AS amt_alipay_njhs_sum_3,
SUM(qty_alipay_njhs)AS qty_alipay_njhs_sum_3,SUM(unum_alipay_njhs)AS unum_alipay_njhs_sum_3
FROM(
SELECT a.* FROM(
SELECT a.*,DATEDIFF('2015/12/14',DATE)AS days FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1)a WHERE days<=3)a GROUP BY item_id
)d ON(a.item_id=d.item_id) LEFT OUTER JOIN(
/*最近5天*/
SELECT item_id,AVG(pv_ipv)AS pv_ipv_5,AVG(pv_uv) AS pv_uv_5,AVG(cart_ipv)AS cart_ipv_5,AVG(cart_uv)AS cart_uv_5,
AVG(collect_uv)AS collect_uv_5,AVG(num_gmv)AS num_gmv_5,AVG(amt_gmv)AS amt_gmv_5,AVG(qty_gmv)AS qty_gmv_5,
AVG(unum_gmv)AS unum_gmv_5,AVG(amt_alipay)AS amt_alipay_5,AVG(num_alipay)AS num_alipay_5,AVG(qty_alipay)AS qty_alipay_5,
AVG(unum_alipay)AS unum_alipay_5,AVG(ztc_pv_ipv)AS ztc_pv_ipv_5,AVG(tbk_pv_ipv)AS tbk_pv_ipv_5,AVG(ss_pv_ipv)AS ss_pv_ipv_5,
AVG(jhs_pv_ipv)AS jhs_pv_ipv_5,AVG(ztc_pv_uv)AS ztc_pv_uv_5,AVG(tbk_pv_uv)AS tbk_pv_uv_5,AVG(ss_pv_uv)AS ss_pv_uv_5,
AVG(jhs_pv_uv)AS jhs_pv_uv_5,AVG(num_alipay_njhs)AS num_alipay_njhs_5,AVG(amt_alipay_njhs)AS amt_alipay_njhs_5,
AVG(qty_alipay_njhs)AS qty_alipay_njhs_5,AVG(unum_alipay_njhs)AS unum_alipay_njhs_5,
SUM(pv_ipv)AS pv_ipv_sum_5,SUM(pv_uv) AS pv_uv_sum_5,SUM(cart_ipv)AS cart_ipv_sum_5,SUM(cart_uv)AS cart_uv_sum_5,
SUM(collect_uv)AS collect_uv_sum_5,SUM(num_gmv)AS num_gmv_sum_5,SUM(amt_gmv)AS amt_gmv_sum_5,SUM(qty_gmv)AS qty_gmv_sum_5,
SUM(unum_gmv)AS unum_gmv_sum_5,SUM(amt_alipay)AS amt_alipay_sum_5,SUM(num_alipay)AS num_alipay_sum_5,SUM(qty_alipay)AS qty_alipay_sum_5,
SUM(unum_alipay)AS unum_alipay_sum_5,SUM(ztc_pv_ipv)AS ztc_pv_ipv_sum_5,SUM(tbk_pv_ipv)AS tbk_pv_ipv_sum_5,SUM(ss_pv_ipv)AS ss_pv_ipv_sum_5,
SUM(jhs_pv_ipv)AS jhs_pv_ipv_sum_5,SUM(ztc_pv_uv)AS ztc_pv_uv_sum_5,SUM(tbk_pv_uv)AS tbk_pv_uv_sum_5,SUM(ss_pv_uv)AS ss_pv_uv_sum_5,
SUM(jhs_pv_uv)AS jhs_pv_uv_sum_5,SUM(num_alipay_njhs)AS num_alipay_njhs_sum_5,SUM(amt_alipay_njhs)AS amt_alipay_njhs_sum_5,
SUM(qty_alipay_njhs)AS qty_alipay_njhs_sum_5,SUM(unum_alipay_njhs)AS unum_alipay_njhs_sum_5
FROM(
SELECT a.* FROM(
SELECT a.*,DATEDIFF('2015/12/14',DATE)AS days FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1)a WHERE days<=5)a GROUP BY item_id
)e ON(a.item_id=e.item_id) LEFT OUTER JOIN(
/*最近7天*/
SELECT item_id,AVG(pv_ipv)AS pv_ipv_7,AVG(pv_uv) AS pv_uv_7,AVG(cart_ipv)AS cart_ipv_7,AVG(cart_uv)AS cart_uv_7,
AVG(collect_uv)AS collect_uv_7,AVG(num_gmv)AS num_gmv_7,AVG(amt_gmv)AS amt_gmv_7,AVG(qty_gmv)AS qty_gmv_7,
AVG(unum_gmv)AS unum_gmv_7,AVG(amt_alipay)AS amt_alipay_7,AVG(num_alipay)AS num_alipay_7,AVG(qty_alipay)AS qty_alipay_7,
AVG(unum_alipay)AS unum_alipay_7,AVG(ztc_pv_ipv)AS ztc_pv_ipv_7,AVG(tbk_pv_ipv)AS tbk_pv_ipv_7,AVG(ss_pv_ipv)AS ss_pv_ipv_7,
AVG(jhs_pv_ipv)AS jhs_pv_ipv_7,AVG(ztc_pv_uv)AS ztc_pv_uv_7,AVG(tbk_pv_uv)AS tbk_pv_uv_7,AVG(ss_pv_uv)AS ss_pv_uv_7,
AVG(jhs_pv_uv)AS jhs_pv_uv_7,AVG(num_alipay_njhs)AS num_alipay_njhs_7,AVG(amt_alipay_njhs)AS amt_alipay_njhs_7,
AVG(qty_alipay_njhs)AS qty_alipay_njhs_7,AVG(unum_alipay_njhs)AS unum_alipay_njhs_7,
SUM(pv_ipv)AS pv_ipv_sum_7,SUM(pv_uv) AS pv_uv_sum_7,SUM(cart_ipv)AS cart_ipv_sum_7,SUM(cart_uv)AS cart_uv_sum_7,
SUM(collect_uv)AS collect_uv_sum_7,SUM(num_gmv)AS num_gmv_sum_7,SUM(amt_gmv)AS amt_gmv_sum_7,SUM(qty_gmv)AS qty_gmv_sum_7,
SUM(unum_gmv)AS unum_gmv_sum_7,SUM(amt_alipay)AS amt_alipay_sum_7,SUM(num_alipay)AS num_alipay_sum_7,SUM(qty_alipay)AS qty_alipay_sum_7,
SUM(unum_alipay)AS unum_alipay_sum_7,SUM(ztc_pv_ipv)AS ztc_pv_ipv_sum_7,SUM(tbk_pv_ipv)AS tbk_pv_ipv_sum_7,SUM(ss_pv_ipv)AS ss_pv_ipv_sum_7,
SUM(jhs_pv_ipv)AS jhs_pv_ipv_sum_7,SUM(ztc_pv_uv)AS ztc_pv_uv_sum_7,SUM(tbk_pv_uv)AS tbk_pv_uv_sum_7,SUM(ss_pv_uv)AS ss_pv_uv_sum_7,
SUM(jhs_pv_uv)AS jhs_pv_uv_sum_7,SUM(num_alipay_njhs)AS num_alipay_njhs_sum_7,SUM(amt_alipay_njhs)AS amt_alipay_njhs_sum_7,
SUM(qty_alipay_njhs)AS qty_alipay_njhs_sum_7,SUM(unum_alipay_njhs)AS unum_alipay_njhs_sum_7
FROM(
SELECT a.* FROM(
SELECT a.*,DATEDIFF('2015/12/14',DATE)AS days FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1)a WHERE days<=7)a GROUP BY item_id
)f ON(a.item_id=f.item_id) LEFT OUTER JOIN(
/*最近9天*/
SELECT item_id,AVG(pv_ipv)AS pv_ipv_9,AVG(pv_uv) AS pv_uv_9,AVG(cart_ipv)AS cart_ipv_9,AVG(cart_uv)AS cart_uv_9,
AVG(collect_uv)AS collect_uv_9,AVG(num_gmv)AS num_gmv_9,AVG(amt_gmv)AS amt_gmv_9,AVG(qty_gmv)AS qty_gmv_9,
AVG(unum_gmv)AS unum_gmv_9,AVG(amt_alipay)AS amt_alipay_9,AVG(num_alipay)AS num_alipay_9,AVG(qty_alipay)AS qty_alipay_9,
AVG(unum_alipay)AS unum_alipay_9,AVG(ztc_pv_ipv)AS ztc_pv_ipv_9,AVG(tbk_pv_ipv)AS tbk_pv_ipv_9,AVG(ss_pv_ipv)AS ss_pv_ipv_9,
AVG(jhs_pv_ipv)AS jhs_pv_ipv_9,AVG(ztc_pv_uv)AS ztc_pv_uv_9,AVG(tbk_pv_uv)AS tbk_pv_uv_9,AVG(ss_pv_uv)AS ss_pv_uv_9,
AVG(jhs_pv_uv)AS jhs_pv_uv_9,AVG(num_alipay_njhs)AS num_alipay_njhs_9,AVG(amt_alipay_njhs)AS amt_alipay_njhs_9,
AVG(qty_alipay_njhs)AS qty_alipay_njhs_9,AVG(unum_alipay_njhs)AS unum_alipay_njhs_9,
SUM(pv_ipv)AS pv_ipv_sum_9,SUM(pv_uv) AS pv_uv_sum_9,SUM(cart_ipv)AS cart_ipv_sum_9,SUM(cart_uv)AS cart_uv_sum_9,
SUM(collect_uv)AS collect_uv_sum_9,SUM(num_gmv)AS num_gmv_sum_9,SUM(amt_gmv)AS amt_gmv_sum_9,SUM(qty_gmv)AS qty_gmv_sum_9,
SUM(unum_gmv)AS unum_gmv_sum_9,SUM(amt_alipay)AS amt_alipay_sum_9,SUM(num_alipay)AS num_alipay_sum_9,SUM(qty_alipay)AS qty_alipay_sum_9,
SUM(unum_alipay)AS unum_alipay_sum_9,SUM(ztc_pv_ipv)AS ztc_pv_ipv_sum_9,SUM(tbk_pv_ipv)AS tbk_pv_ipv_sum_9,SUM(ss_pv_ipv)AS ss_pv_ipv_sum_9,
SUM(jhs_pv_ipv)AS jhs_pv_ipv_sum_9,SUM(ztc_pv_uv)AS ztc_pv_uv_sum_9,SUM(tbk_pv_uv)AS tbk_pv_uv_sum_9,SUM(ss_pv_uv)AS ss_pv_uv_sum_9,
SUM(jhs_pv_uv)AS jhs_pv_uv_sum_9,SUM(num_alipay_njhs)AS num_alipay_njhs_sum_9,SUM(amt_alipay_njhs)AS amt_alipay_njhs_sum_9,
SUM(qty_alipay_njhs)AS qty_alipay_njhs_sum_9,SUM(unum_alipay_njhs)AS unum_alipay_njhs_sum_9
FROM(
SELECT a.* FROM(
SELECT a.*,DATEDIFF('2015/12/14',DATE)AS days FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1)a WHERE days<=9)a GROUP BY item_id
)g ON(a.item_id=g.item_id) LEFT OUTER JOIN(
/*最近11天*/
SELECT item_id,AVG(pv_ipv)AS pv_ipv_11,AVG(pv_uv) AS pv_uv_11,AVG(cart_ipv)AS cart_ipv_11,AVG(cart_uv)AS cart_uv_11,
AVG(collect_uv)AS collect_uv_11,AVG(num_gmv)AS num_gmv_11,AVG(amt_gmv)AS amt_gmv_11,AVG(qty_gmv)AS qty_gmv_11,
AVG(unum_gmv)AS unum_gmv_11,AVG(amt_alipay)AS amt_alipay_11,AVG(num_alipay)AS num_alipay_11,AVG(qty_alipay)AS qty_alipay_11,
AVG(unum_alipay)AS unum_alipay_11,AVG(ztc_pv_ipv)AS ztc_pv_ipv_11,AVG(tbk_pv_ipv)AS tbk_pv_ipv_11,AVG(ss_pv_ipv)AS ss_pv_ipv_11,
AVG(jhs_pv_ipv)AS jhs_pv_ipv_11,AVG(ztc_pv_uv)AS ztc_pv_uv_11,AVG(tbk_pv_uv)AS tbk_pv_uv_11,AVG(ss_pv_uv)AS ss_pv_uv_11,
AVG(jhs_pv_uv)AS jhs_pv_uv_11,AVG(num_alipay_njhs)AS num_alipay_njhs_11,AVG(amt_alipay_njhs)AS amt_alipay_njhs_11,
AVG(qty_alipay_njhs)AS qty_alipay_njhs_11,AVG(unum_alipay_njhs)AS unum_alipay_njhs_11,
SUM(pv_ipv)AS pv_ipv_sum_11,SUM(pv_uv) AS pv_uv_sum_11,SUM(cart_ipv)AS cart_ipv_sum_11,SUM(cart_uv)AS cart_uv_sum_11,
SUM(collect_uv)AS collect_uv_sum_11,SUM(num_gmv)AS num_gmv_sum_11,SUM(amt_gmv)AS amt_gmv_sum_11,SUM(qty_gmv)AS qty_gmv_sum_11,
SUM(unum_gmv)AS unum_gmv_sum_11,SUM(amt_alipay)AS amt_alipay_sum_11,SUM(num_alipay)AS num_alipay_sum_11,SUM(qty_alipay)AS qty_alipay_sum_11,
SUM(unum_alipay)AS unum_alipay_sum_11,SUM(ztc_pv_ipv)AS ztc_pv_ipv_sum_11,SUM(tbk_pv_ipv)AS tbk_pv_ipv_sum_11,SUM(ss_pv_ipv)AS ss_pv_ipv_sum_11,
SUM(jhs_pv_ipv)AS jhs_pv_ipv_sum_11,SUM(ztc_pv_uv)AS ztc_pv_uv_sum_11,SUM(tbk_pv_uv)AS tbk_pv_uv_sum_11,SUM(ss_pv_uv)AS ss_pv_uv_sum_11,
SUM(jhs_pv_uv)AS jhs_pv_uv_sum_11,SUM(num_alipay_njhs)AS num_alipay_njhs_sum_11,SUM(amt_alipay_njhs)AS amt_alipay_njhs_sum_11,
SUM(qty_alipay_njhs)AS qty_alipay_njhs_sum_11,SUM(unum_alipay_njhs)AS unum_alipay_njhs_sum_11
FROM(
SELECT a.* FROM(
SELECT a.*,DATEDIFF('2015/12/14',DATE)AS days FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1)a WHERE days<=11)a GROUP BY item_id
)h ON(a.item_id=h.item_id) LEFT OUTER JOIN(
/*最近14天*/
SELECT item_id,AVG(pv_ipv)AS pv_ipv_14,AVG(pv_uv) AS pv_uv_14,AVG(cart_ipv)AS cart_ipv_14,AVG(cart_uv)AS cart_uv_14,
AVG(collect_uv)AS collect_uv_14,AVG(num_gmv)AS num_gmv_14,AVG(amt_gmv)AS amt_gmv_14,AVG(qty_gmv)AS qty_gmv_14,
AVG(unum_gmv)AS unum_gmv_14,AVG(amt_alipay)AS amt_alipay_14,AVG(num_alipay)AS num_alipay_14,AVG(qty_alipay)AS qty_alipay_14,
AVG(unum_alipay)AS unum_alipay_14,AVG(ztc_pv_ipv)AS ztc_pv_ipv_14,AVG(tbk_pv_ipv)AS tbk_pv_ipv_14,AVG(ss_pv_ipv)AS ss_pv_ipv_14,
AVG(jhs_pv_ipv)AS jhs_pv_ipv_14,AVG(ztc_pv_uv)AS ztc_pv_uv_14,AVG(tbk_pv_uv)AS tbk_pv_uv_14,AVG(ss_pv_uv)AS ss_pv_uv_14,
AVG(jhs_pv_uv)AS jhs_pv_uv_14,AVG(num_alipay_njhs)AS num_alipay_njhs_14,AVG(amt_alipay_njhs)AS amt_alipay_njhs_14,
AVG(qty_alipay_njhs)AS qty_alipay_njhs_14,AVG(unum_alipay_njhs)AS unum_alipay_njhs_14,
SUM(pv_ipv)AS pv_ipv_sum_14,SUM(pv_uv) AS pv_uv_sum_14,SUM(cart_ipv)AS cart_ipv_sum_14,SUM(cart_uv)AS cart_uv_sum_14,
SUM(collect_uv)AS collect_uv_sum_14,SUM(num_gmv)AS num_gmv_sum_14,SUM(amt_gmv)AS amt_gmv_sum_14,SUM(qty_gmv)AS qty_gmv_sum_14,
SUM(unum_gmv)AS unum_gmv_sum_14,SUM(amt_alipay)AS amt_alipay_sum_14,SUM(num_alipay)AS num_alipay_sum_14,SUM(qty_alipay)AS qty_alipay_sum_14,
SUM(unum_alipay)AS unum_alipay_sum_14,SUM(ztc_pv_ipv)AS ztc_pv_ipv_sum_14,SUM(tbk_pv_ipv)AS tbk_pv_ipv_sum_14,SUM(ss_pv_ipv)AS ss_pv_ipv_sum_14,
SUM(jhs_pv_ipv)AS jhs_pv_ipv_sum_14,SUM(ztc_pv_uv)AS ztc_pv_uv_sum_14,SUM(tbk_pv_uv)AS tbk_pv_uv_sum_14,SUM(ss_pv_uv)AS ss_pv_uv_sum_14,
SUM(jhs_pv_uv)AS jhs_pv_uv_sum_14,SUM(num_alipay_njhs)AS num_alipay_njhs_sum_14,SUM(amt_alipay_njhs)AS amt_alipay_njhs_sum_14,
SUM(qty_alipay_njhs)AS qty_alipay_njhs_sum_14,SUM(unum_alipay_njhs)AS unum_alipay_njhs_sum_14
FROM(
SELECT a.* FROM(
SELECT a.*,DATEDIFF('2015/12/14',DATE)AS days FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1)a WHERE days<=14)a GROUP BY item_id
)i ON(a.item_id=i.item_id)LEFT OUTER JOIN(
/*非聚划算销量最值，标准差*/
SELECT item_id,MAX(qty_alipay_njhs)AS max_qty_alipay_njhs,MIN(qty_alipay_njhs)AS min_qty_alipay_njhs,STD(qty_alipay_njhs)AS std_qty_alipay_njhs
FROM(
SELECT a.*,DATEDIFF('2015/12/14',DATE)AS days FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1)a GROUP BY item_id
)j ON (a.item_id=j.item_id)
LEFT OUTER JOIN(
/*item与其他id对应关系*/
SELECT a.item_id,b.*,c.*,d.*,e.* 
FROM(
SELECT item_id,cate_id,cate_level_id,brand_id,supplier_id
FROM item_feature GROUP BY item_id,cate_id,cate_level_id,brand_id,supplier_id
)a LEFT OUTER JOIN (
/*叶子类目id特征*/
SELECT cate_id,SUM(qty_alipay_njhs)AS cate_id_qty_alipay_njhs_sum,AVG(qty_alipay_njhs)AS cate_id_qty_alipay_njhs_avg,STD(qty_alipay_njhs)AS cate_id_qty_alipay_njhs_std
FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1 GROUP BY cate_id
)b ON(a.cate_id=b.cate_id) LEFT OUTER JOIN(
/*大类目ID特征*/
SELECT cate_level_id,SUM(qty_alipay_njhs)AS cate_level_id_qty_alipay_njhs_sum,AVG(qty_alipay_njhs)AS cate_level_id_qty_alipay_njhs_avg,STD(qty_alipay_njhs)AS cate_level_id_qty_alipay_njhs_std
FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1 GROUP BY cate_level_id
)c ON(a.cate_level_id=c.cate_level_id) LEFT OUTER JOIN(
/*品牌ID特征*/
SELECT brand_id,SUM(qty_alipay_njhs)AS brand_id_qty_alipay_njhs_sum,AVG(qty_alipay_njhs)AS brand_id_qty_alipay_njhs_avg,STD(qty_alipay_njhs)AS brand_id_qty_alipay_njhs_std
FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1 GROUP BY brand_id
)d ON(a.brand_id=d.brand_id) LEFT OUTER JOIN(
/*供应商ID特征*/
SELECT supplier_id,SUM(qty_alipay_njhs)AS supplier_id_qty_alipay_njhs_sum,AVG(qty_alipay_njhs)AS supplier_id_qty_alipay_njhs_avg,STD(qty_alipay_njhs)AS supplier_id_qty_alipay_njhs_std
FROM(
SELECT a.*,FLOOR((DATEDIFF('2015/12/28',DATE)-1)/14) AS watch FROM(
SELECT * FROM item_feature )a)a WHERE watch=1 GROUP BY supplier_id
)e ON(a.supplier_id=e.supplier_id) 
)k ON(a.item_id=k.item_id)
;